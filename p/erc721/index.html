<!doctype html><html lang=zh-cn dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="标准实现ERC721智能合约"><title>ERC721合约</title><link rel=canonical href=https://superlitian.github.io/p/erc721/><link rel=stylesheet href=/scss/style.min.2a426798c147941971a3556278c8cfb14775867d8c34a1f67a6827752a1b4bd5.css><meta property="og:title" content="ERC721合约"><meta property="og:description" content="标准实现ERC721智能合约"><meta property="og:url" content="https://superlitian.github.io/p/erc721/"><meta property="og:site_name" content="Laertes"><meta property="og:type" content="article"><meta property="article:section" content="Post"><meta property="article:tag" content="Solidity"><meta property="article:published_time" content="2022-09-29T00:00:00+00:00"><meta property="article:modified_time" content="2022-09-29T00:00:00+00:00"><meta name=twitter:title content="ERC721合约"><meta name=twitter:description content="标准实现ERC721智能合约"><link rel="shortcut icon" href=/favicon.ico></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=切换菜单>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/avatar_hufe0ee12878b7caa9845abd9976ff67a8_90270_300x0_resize_q75_box.jpg width=300 height=300 class=site-logo loading=lazy alt=Avatar></a>
<span class=emoji>😩</span></figure><div class=site-meta><h1 class=site-name><a href=/>Laertes</a></h1><h2 class=site-description>想找一份稳定的工作。</h2></div></header><ol class=social-menu><li><a href=https://github.com/superlitian target=_blank title=GitHub><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg><span>Home</span></a></li><li><a href=/archives/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg><span>Archives</span></a></li><li><a href=/search/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg><span>Search</span></a></li><div class=menu-bottom-section><li id=dark-mode-toggle><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><span>暗色模式</span></li></div></ol></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/contract/>Contract</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/p/erc721/>ERC721合约</a></h2><h3 class=article-subtitle>标准实现ERC721智能合约</h3></div><footer class=article-time><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg><time class=article-time--published>Sep 29, 2022</time></div><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><time class=article-time--reading>阅读时长: 5 分钟</time></div></footer></div></header><section class=article-content><h3 id=erc721>ERC721</h3><div class=codeblock><header><span class=codeblock-lang>solidity</span>
<button class=codeblock-copy data-id=codeblock-id-0 data-copied-text=Copied!>
Copy</button></header><code id=codeblock-id-0 style=display:none>// SPDX-License-Identifier: SimPL-2.0
pragma solidity ^0.8.10;
interface IERC721Receiver{
function onERC721Received(
address operator,
address from,
uint256 tokenId,
bytes calldata data
) external returns (bytes4);
}
contract Cafe721 {
using SafeMath for uint256;
//creator
address private contractCreator;
// name
string private _name;
// symbol
string private _symbol;
// Token
struct Cafe {
address creator;
address owner;
address approved;
bytes32 summary;
string uri;
}
// all Cafe
mapping (uint256 => Cafe) allCafe;
// cafe's counts
uint256 _totalCafe;
// User
struct User {
uint256[] cafes;
uint256 totalCafe;
}
// all user
mapping (address => User) allUser;
// operator approvals
mapping (address => mapping (address => bool)) operatorApprovals;
constructor(string memory name_, string memory symbol_){
contractCreator = theSender();
_name = name_;
_symbol = symbol_;
}
event Transfer(address indexed _from, address indexed _to, uint256 indexed _tokenId);
event Approval(address indexed _owner, address indexed _approved, uint256 indexed _tokenId);
event ApprovalForAll(address indexed _owner, address indexed _operator, bool _approved);
/*
* the address have how much tokens
*/
function balanceOf(address _owner) external view returns (uint256 balance) {
return allUser[_owner].totalCafe;
}
function cafesOf(address _owner) external view returns (uint256[] memory cafes){
return allUser[_owner].cafes;
}
/*
* the token's owner
*/
function ownerOf(uint256 _tokenId) external view returns (address owner) {
return allCafe[_tokenId].owner;
}
function creatorOf(uint256 _tokenId) external view returns (address creator) {
return allCafe[_tokenId].creator;
}
// trans begin
function transferFrom(address _from, address _to, uint256 _tokenId) public returns (bool success) {
// checked token
require(exists(_tokenId), "Cafe721: the cafe is not exists");
// checked addr
require(zeroAddr(_from), "Cafe721: can not from the zero address");
require(zeroAddr(_to), "Cafe721: can not to the zero address");
// checked permission
require(isApprovedOrOwner(_tokenId), "Cafe721: no permission");
// remove cafe
remove(_from, _tokenId);
// transfer cafe
allCafe[_tokenId].owner = _to;
allCafe[_tokenId].approved = address(0);
// add cafe
allUser[_to].cafes.push(_tokenId);
allUser[_to].totalCafe = allUser[_to].totalCafe.add(1);
emit Transfer(_from, _to, _tokenId);
return true;
}
function safeTransferFrom(address _from, address _to, uint256 _tokenId) external virtual returns (bool success) {
return safeTransferFrom(_from, _to, _tokenId, "");
}
function safeTransferFrom(address _from, address _to, uint256 _tokenId, bytes memory _data) public virtual returns (bool success) {
require(isApprovedOrOwner(_tokenId), "Cafe721: no permission");
transferFrom(_from, _to, _tokenId);
require(checkOnERC721Received(_from, _to, _tokenId, _data), "Cafe721: transfer to non ERC721Receiver implementer");
return true;
}
// trans end
function approve(address _approved, uint256 _tokenId) external returns (bool success) {
require(allCafe[_tokenId].owner == theSender(), "Cafe721: no permission");
require(_approved != theSender(), "Cafe721: can not approved for owner");
allCafe[_tokenId].approved = _approved;
emit Approval(theSender(), _approved, _tokenId);
return true;
}
function setApprovalForAll(address _operator, bool _approved) external returns (bool success) {
require(_operator != theSender(), "Cafe721: can not approved for owner");
operatorApprovals[theSender()][_operator] = _approved;
emit ApprovalForAll(theSender(), _operator, _approved);
return true;
}
function getApproved(uint256 _tokenId) private view returns(address) {
return allCafe[_tokenId].approved;
}
function isApprovedForAll(address _owner, address _operator) public view returns (bool) {
return operatorApprovals[_owner][_operator];
}
function name() external view returns (string memory) {
return _name;
}
function symbol() external view returns (string memory) {
return _symbol;
}
function tokenURI(uint256 _tokenId) external view returns (string memory uri) {
return allCafe[_tokenId].uri;
}
function tokenSummary(uint256 _tokenId) external view returns (bytes32 summary) {
return allCafe[_tokenId].summary;
}
function totalSupply() external view returns (uint256 totalCafe) {
return _totalCafe;
}
function exists(uint256 _tokenId) internal view returns (bool){
return allCafe[_tokenId].owner != address(0);
}
function zeroAddr(address addr) private pure returns (bool) {
return addr != address(0);
}
function remove(address _from, uint256 _tokenId) private {
uint[] storage cafes = allUser[_from].cafes;
for (uint i = 0; i &lt; cafes.length - 1; i++){
if(cafes[i] == _tokenId){
cafes[i] = cafes[cafes.length + 1];
break;
}
}
delete cafes[cafes.length - 1];
cafes.pop();
allUser[_from].cafes = cafes;
allUser[_from].totalCafe = allUser[_from].totalCafe.sub(1);
}
/*
* address owner;
* address approved;
* bytes32 summary;
* string uri;
*/
function mint(uint256 _tokenId, bytes32 _summary, string memory _uri) external {
require(allCafe[_tokenId].creator == address(0), "Cafe721: the cafe is exists.");
allCafe[_tokenId].creator = theSender();
allCafe[_tokenId].owner = theSender();
allCafe[_tokenId].approved = address(0);
allCafe[_tokenId].summary = _summary;
allCafe[_tokenId].uri = _uri;
// User
allUser[theSender()].cafes.push(_tokenId);
allUser[theSender()].totalCafe = allUser[theSender()].totalCafe.add(1);
_totalCafe = _totalCafe.add(1);
}
function isApprovedOrOwner(uint256 _tokenId) private view returns (bool) {
require(exists(_tokenId), "Cafe721: the cafe is exists.");
return (theSender() == allCafe[_tokenId].owner || isApprovedForAll(allCafe[_tokenId].owner, theSender()) || getApproved(_tokenId) == theSender());
}
function checkOnERC721Received(address from,address to,uint256 tokenId,bytes memory _data) private returns (bool) {
if (to.code.length > 0) {
try IERC721Receiver(to).onERC721Received(theSender(), from, tokenId, _data) returns (bytes4 retval) {
return retval == IERC721Receiver.onERC721Received.selector;
} catch (bytes memory reason) {
if (reason.length == 0) {
revert("ERC721: transfer to non ERC721Receiver implementer");
} else {
assembly {
revert(add(32, reason), mload(reason))
}
}
}
} else {
return true;
}
}
// destroyCafe
function destroyCafe(uint256 _tokenId) external returns (bool success) {
require(allCafe[_tokenId].owner == theSender(), "Cafe721: no premission");
remove(theSender(), _tokenId);
delete allCafe[_tokenId];
_totalCafe = _totalCafe.sub(1);
return true;
}
function theSender() internal view returns (address) {
return msg.sender;
}
}
library SafeMath {
function mul(uint256 a, uint256 b) internal pure returns (uint256) {
// Gas optimization: this is cheaper than requiring 'a' not being zero, but the
// benefit is lost if 'b' is also tested.
// See: https://github.com/OpenZeppelin/openzeppelin-solidity/pull/522
if (a == 0) {
return 0;
}
uint256 c = a * b;
require(c / a == b);
return c;
}
/**
* @dev Integer division of two numbers truncating the quotient, reverts on division by zero.
*/
function div(uint256 a, uint256 b) internal pure returns (uint256) {
require(b > 0); // Solidity only automatically asserts when dividing by 0
uint256 c = a / b;
// assert(a == b * c + a % b); // There is no case in which this doesn't hold
return c;
}
/**
* @dev Subtracts two numbers, reverts on overflow (i.e. if subtrahend is greater than minuend).
*/
function sub(uint256 a, uint256 b) internal pure returns (uint256) {
require(b &lt;= a);
uint256 c = a - b;
return c;
}
/**
* @dev Adds two numbers, reverts on overflow.
*/
function add(uint256 a, uint256 b) internal pure returns (uint256) {
uint256 c = a + b;
require(c >= a);
return c;
}
/**
* @dev Divides two numbers and returns the remainder (unsigned integer modulo),
* reverts when dividing by zero.
*/
function mod(uint256 a, uint256 b) internal pure returns (uint256) {
require(b != 0);
return a % b;
}
}</code><div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span><span class=lnt>149
</span><span class=lnt>150
</span><span class=lnt>151
</span><span class=lnt>152
</span><span class=lnt>153
</span><span class=lnt>154
</span><span class=lnt>155
</span><span class=lnt>156
</span><span class=lnt>157
</span><span class=lnt>158
</span><span class=lnt>159
</span><span class=lnt>160
</span><span class=lnt>161
</span><span class=lnt>162
</span><span class=lnt>163
</span><span class=lnt>164
</span><span class=lnt>165
</span><span class=lnt>166
</span><span class=lnt>167
</span><span class=lnt>168
</span><span class=lnt>169
</span><span class=lnt>170
</span><span class=lnt>171
</span><span class=lnt>172
</span><span class=lnt>173
</span><span class=lnt>174
</span><span class=lnt>175
</span><span class=lnt>176
</span><span class=lnt>177
</span><span class=lnt>178
</span><span class=lnt>179
</span><span class=lnt>180
</span><span class=lnt>181
</span><span class=lnt>182
</span><span class=lnt>183
</span><span class=lnt>184
</span><span class=lnt>185
</span><span class=lnt>186
</span><span class=lnt>187
</span><span class=lnt>188
</span><span class=lnt>189
</span><span class=lnt>190
</span><span class=lnt>191
</span><span class=lnt>192
</span><span class=lnt>193
</span><span class=lnt>194
</span><span class=lnt>195
</span><span class=lnt>196
</span><span class=lnt>197
</span><span class=lnt>198
</span><span class=lnt>199
</span><span class=lnt>200
</span><span class=lnt>201
</span><span class=lnt>202
</span><span class=lnt>203
</span><span class=lnt>204
</span><span class=lnt>205
</span><span class=lnt>206
</span><span class=lnt>207
</span><span class=lnt>208
</span><span class=lnt>209
</span><span class=lnt>210
</span><span class=lnt>211
</span><span class=lnt>212
</span><span class=lnt>213
</span><span class=lnt>214
</span><span class=lnt>215
</span><span class=lnt>216
</span><span class=lnt>217
</span><span class=lnt>218
</span><span class=lnt>219
</span><span class=lnt>220
</span><span class=lnt>221
</span><span class=lnt>222
</span><span class=lnt>223
</span><span class=lnt>224
</span><span class=lnt>225
</span><span class=lnt>226
</span><span class=lnt>227
</span><span class=lnt>228
</span><span class=lnt>229
</span><span class=lnt>230
</span><span class=lnt>231
</span><span class=lnt>232
</span><span class=lnt>233
</span><span class=lnt>234
</span><span class=lnt>235
</span><span class=lnt>236
</span><span class=lnt>237
</span><span class=lnt>238
</span><span class=lnt>239
</span><span class=lnt>240
</span><span class=lnt>241
</span><span class=lnt>242
</span><span class=lnt>243
</span><span class=lnt>244
</span><span class=lnt>245
</span><span class=lnt>246
</span><span class=lnt>247
</span><span class=lnt>248
</span><span class=lnt>249
</span><span class=lnt>250
</span><span class=lnt>251
</span><span class=lnt>252
</span><span class=lnt>253
</span><span class=lnt>254
</span><span class=lnt>255
</span><span class=lnt>256
</span><span class=lnt>257
</span><span class=lnt>258
</span><span class=lnt>259
</span><span class=lnt>260
</span><span class=lnt>261
</span><span class=lnt>262
</span><span class=lnt>263
</span><span class=lnt>264
</span><span class=lnt>265
</span><span class=lnt>266
</span><span class=lnt>267
</span><span class=lnt>268
</span><span class=lnt>269
</span><span class=lnt>270
</span><span class=lnt>271
</span><span class=lnt>272
</span><span class=lnt>273
</span><span class=lnt>274
</span><span class=lnt>275
</span><span class=lnt>276
</span><span class=lnt>277
</span><span class=lnt>278
</span><span class=lnt>279
</span><span class=lnt>280
</span><span class=lnt>281
</span><span class=lnt>282
</span><span class=lnt>283
</span><span class=lnt>284
</span><span class=lnt>285
</span><span class=lnt>286
</span><span class=lnt>287
</span><span class=lnt>288
</span><span class=lnt>289
</span><span class=lnt>290
</span><span class=lnt>291
</span><span class=lnt>292
</span><span class=lnt>293
</span><span class=lnt>294
</span><span class=lnt>295
</span><span class=lnt>296
</span><span class=lnt>297
</span><span class=lnt>298
</span><span class=lnt>299
</span><span class=lnt>300
</span><span class=lnt>301
</span><span class=lnt>302
</span><span class=lnt>303
</span><span class=lnt>304
</span><span class=lnt>305
</span><span class=lnt>306
</span><span class=lnt>307
</span><span class=lnt>308
</span><span class=lnt>309
</span><span class=lnt>310
</span><span class=lnt>311
</span><span class=lnt>312
</span><span class=lnt>313
</span><span class=lnt>314
</span><span class=lnt>315
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-solidity data-lang=solidity><span class=line><span class=cl><span class=c1>// SPDX-License-Identifier: SimPL-2.0
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=k>pragma solidity</span> <span class=o>^</span><span class=mi>0</span><span class=p>.</span><span class=mi>8</span><span class=p>.</span><span class=mi>10</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>interface</span> <span class=nc>IERC721Receiver</span><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>function</span> <span class=nf>onERC721Received</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=kt>address</span> <span class=n>operator</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=kt>address</span> <span class=k>from</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=kt>uint256</span> <span class=n>tokenId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=kt>bytes</span> <span class=n>calldata</span> <span class=nb>data</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span> <span class=k>external</span> <span class=k>returns</span> <span class=p>(</span><span class=kt>bytes4</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>contract</span> <span class=nc>Cafe721</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kn>using</span> <span class=n>SafeMath</span> <span class=k>for</span> <span class=kt>uint256</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=c1>//creator
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>address</span> <span class=k>private</span> <span class=n>contractCreator</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// name
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>string</span> <span class=k>private</span> <span class=n>_name</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// symbol
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>string</span> <span class=k>private</span> <span class=n>_symbol</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// Token
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kd>struct</span> <span class=nc>Cafe</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=kt>address</span> <span class=n>creator</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=kt>address</span> <span class=n>owner</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=kt>address</span> <span class=n>approved</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=kt>bytes32</span> <span class=n>summary</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=kt>string</span> <span class=n>uri</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// all Cafe
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kd>mapping</span> <span class=p>(</span><span class=kt>uint256</span> <span class=o>=&gt;</span> <span class=n>Cafe</span><span class=p>)</span> <span class=n>allCafe</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// cafe&#39;s counts
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>uint256</span> <span class=n>_totalCafe</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// User
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kd>struct</span> <span class=nc>User</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>uint256</span><span class=p>[]</span> <span class=n>cafes</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>uint256</span> <span class=n>totalCafe</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// all user
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kd>mapping</span> <span class=p>(</span><span class=kt>address</span> <span class=o>=&gt;</span> <span class=n>User</span><span class=p>)</span> <span class=n>allUser</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// operator approvals
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kd>mapping</span> <span class=p>(</span><span class=kt>address</span> <span class=o>=&gt;</span> <span class=kd>mapping</span> <span class=p>(</span><span class=kt>address</span> <span class=o>=&gt;</span> <span class=kt>bool</span><span class=p>))</span> <span class=n>operatorApprovals</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kd>constructor</span><span class=p>(</span><span class=kt>string</span> <span class=k>memory</span> <span class=n>name_</span><span class=p>,</span> <span class=kt>string</span> <span class=k>memory</span> <span class=n>symbol_</span><span class=p>){</span>
</span></span><span class=line><span class=cl>    <span class=n>contractCreator</span> <span class=o>=</span> <span class=n>theSender</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=n>_name</span> <span class=o>=</span> <span class=n>name_</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>_symbol</span> <span class=o>=</span> <span class=n>symbol_</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kd>event</span> <span class=nc>Transfer</span><span class=p>(</span><span class=kt>address</span> <span class=k>indexed</span> <span class=n>_from</span><span class=p>,</span> <span class=kt>address</span> <span class=k>indexed</span> <span class=n>_to</span><span class=p>,</span> <span class=kt>uint256</span> <span class=k>indexed</span> <span class=n>_tokenId</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kd>event</span> <span class=nc>Approval</span><span class=p>(</span><span class=kt>address</span> <span class=k>indexed</span> <span class=n>_owner</span><span class=p>,</span> <span class=kt>address</span> <span class=k>indexed</span> <span class=n>_approved</span><span class=p>,</span> <span class=kt>uint256</span> <span class=k>indexed</span> <span class=n>_tokenId</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kd>event</span> <span class=nc>ApprovalForAll</span><span class=p>(</span><span class=kt>address</span> <span class=k>indexed</span> <span class=n>_owner</span><span class=p>,</span> <span class=kt>address</span> <span class=k>indexed</span> <span class=n>_operator</span><span class=p>,</span> <span class=kt>bool</span> <span class=n>_approved</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=cm>/*
</span></span></span><span class=line><span class=cl><span class=cm>  * the address have how much tokens
</span></span></span><span class=line><span class=cl><span class=cm>  */</span>
</span></span><span class=line><span class=cl>  <span class=kd>function</span> <span class=nf>balanceOf</span><span class=p>(</span><span class=kt>address</span> <span class=n>_owner</span><span class=p>)</span> <span class=k>external</span> <span class=k>view</span> <span class=k>returns</span> <span class=p>(</span><span class=kt>uint256</span> <span class=nb>balance</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>allUser</span><span class=p>[</span><span class=n>_owner</span><span class=p>].</span><span class=n>totalCafe</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kd>function</span> <span class=nf>cafesOf</span><span class=p>(</span><span class=kt>address</span> <span class=n>_owner</span><span class=p>)</span> <span class=k>external</span> <span class=k>view</span> <span class=k>returns</span> <span class=p>(</span><span class=kt>uint256</span><span class=p>[]</span> <span class=k>memory</span> <span class=n>cafes</span><span class=p>){</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>allUser</span><span class=p>[</span><span class=n>_owner</span><span class=p>].</span><span class=n>cafes</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=cm>/*
</span></span></span><span class=line><span class=cl><span class=cm>  * the token&#39;s owner
</span></span></span><span class=line><span class=cl><span class=cm>  */</span>
</span></span><span class=line><span class=cl>  <span class=kd>function</span> <span class=nf>ownerOf</span><span class=p>(</span><span class=kt>uint256</span> <span class=n>_tokenId</span><span class=p>)</span> <span class=k>external</span> <span class=k>view</span> <span class=k>returns</span> <span class=p>(</span><span class=kt>address</span> <span class=n>owner</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>allCafe</span><span class=p>[</span><span class=n>_tokenId</span><span class=p>].</span><span class=n>owner</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kd>function</span> <span class=nf>creatorOf</span><span class=p>(</span><span class=kt>uint256</span> <span class=n>_tokenId</span><span class=p>)</span> <span class=k>external</span> <span class=k>view</span> <span class=k>returns</span> <span class=p>(</span><span class=kt>address</span> <span class=n>creator</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>allCafe</span><span class=p>[</span><span class=n>_tokenId</span><span class=p>].</span><span class=n>creator</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// trans begin
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kd>function</span> <span class=nf>transferFrom</span><span class=p>(</span><span class=kt>address</span> <span class=n>_from</span><span class=p>,</span> <span class=kt>address</span> <span class=n>_to</span><span class=p>,</span> <span class=kt>uint256</span> <span class=n>_tokenId</span><span class=p>)</span> <span class=k>public</span> <span class=k>returns</span> <span class=p>(</span><span class=kt>bool</span> <span class=n>success</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// checked token
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nb>require</span><span class=p>(</span><span class=n>exists</span><span class=p>(</span><span class=n>_tokenId</span><span class=p>),</span> <span class=s>&#34;Cafe721: the cafe is not exists&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=c1>// checked addr
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nb>require</span><span class=p>(</span><span class=n>zeroAddr</span><span class=p>(</span><span class=n>_from</span><span class=p>),</span> <span class=s>&#34;Cafe721: can not from the zero address&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nb>require</span><span class=p>(</span><span class=n>zeroAddr</span><span class=p>(</span><span class=n>_to</span><span class=p>),</span> <span class=s>&#34;Cafe721: can not to the zero address&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=c1>// checked permission
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nb>require</span><span class=p>(</span><span class=n>isApprovedOrOwner</span><span class=p>(</span><span class=n>_tokenId</span><span class=p>),</span> <span class=s>&#34;Cafe721: no permission&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// remove cafe
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>remove</span><span class=p>(</span><span class=n>_from</span><span class=p>,</span> <span class=n>_tokenId</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// transfer cafe
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>allCafe</span><span class=p>[</span><span class=n>_tokenId</span><span class=p>].</span><span class=n>owner</span> <span class=o>=</span> <span class=n>_to</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>allCafe</span><span class=p>[</span><span class=n>_tokenId</span><span class=p>].</span><span class=n>approved</span> <span class=o>=</span> <span class=kt>address</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// add cafe
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>allUser</span><span class=p>[</span><span class=n>_to</span><span class=p>].</span><span class=n>cafes</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>_tokenId</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>allUser</span><span class=p>[</span><span class=n>_to</span><span class=p>].</span><span class=n>totalCafe</span> <span class=o>=</span> <span class=n>allUser</span><span class=p>[</span><span class=n>_to</span><span class=p>].</span><span class=n>totalCafe</span><span class=p>.</span><span class=n>add</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>emit</span> <span class=n>Transfer</span><span class=p>(</span><span class=n>_from</span><span class=p>,</span> <span class=n>_to</span><span class=p>,</span> <span class=n>_tokenId</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=kc>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=kd>function</span> <span class=nf>safeTransferFrom</span><span class=p>(</span><span class=kt>address</span> <span class=n>_from</span><span class=p>,</span> <span class=kt>address</span> <span class=n>_to</span><span class=p>,</span> <span class=kt>uint256</span> <span class=n>_tokenId</span><span class=p>)</span> <span class=k>external</span> <span class=k>virtual</span>  <span class=k>returns</span> <span class=p>(</span><span class=kt>bool</span> <span class=n>success</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>safeTransferFrom</span><span class=p>(</span><span class=n>_from</span><span class=p>,</span> <span class=n>_to</span><span class=p>,</span> <span class=n>_tokenId</span><span class=p>,</span> <span class=s>&#34;&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kd>function</span> <span class=nf>safeTransferFrom</span><span class=p>(</span><span class=kt>address</span> <span class=n>_from</span><span class=p>,</span> <span class=kt>address</span> <span class=n>_to</span><span class=p>,</span> <span class=kt>uint256</span> <span class=n>_tokenId</span><span class=p>,</span> <span class=kt>bytes</span> <span class=k>memory</span> <span class=n>_data</span><span class=p>)</span> <span class=k>public</span> <span class=k>virtual</span> <span class=k>returns</span> <span class=p>(</span><span class=kt>bool</span> <span class=n>success</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>require</span><span class=p>(</span><span class=n>isApprovedOrOwner</span><span class=p>(</span><span class=n>_tokenId</span><span class=p>),</span> <span class=s>&#34;Cafe721: no permission&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>transferFrom</span><span class=p>(</span><span class=n>_from</span><span class=p>,</span> <span class=n>_to</span><span class=p>,</span> <span class=n>_tokenId</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nb>require</span><span class=p>(</span><span class=n>checkOnERC721Received</span><span class=p>(</span><span class=n>_from</span><span class=p>,</span> <span class=n>_to</span><span class=p>,</span> <span class=n>_tokenId</span><span class=p>,</span> <span class=n>_data</span><span class=p>),</span> <span class=s>&#34;Cafe721: transfer to non ERC721Receiver implementer&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=kc>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// trans end
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kd>function</span> <span class=nf>approve</span><span class=p>(</span><span class=kt>address</span> <span class=n>_approved</span><span class=p>,</span> <span class=kt>uint256</span> <span class=n>_tokenId</span><span class=p>)</span> <span class=k>external</span> <span class=k>returns</span> <span class=p>(</span><span class=kt>bool</span> <span class=n>success</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>require</span><span class=p>(</span><span class=n>allCafe</span><span class=p>[</span><span class=n>_tokenId</span><span class=p>].</span><span class=n>owner</span> <span class=o>==</span> <span class=n>theSender</span><span class=p>(),</span> <span class=s>&#34;Cafe721: no permission&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nb>require</span><span class=p>(</span><span class=n>_approved</span> <span class=o>!=</span> <span class=n>theSender</span><span class=p>(),</span> <span class=s>&#34;Cafe721: can not approved for owner&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>allCafe</span><span class=p>[</span><span class=n>_tokenId</span><span class=p>].</span><span class=n>approved</span> <span class=o>=</span> <span class=n>_approved</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>emit</span> <span class=n>Approval</span><span class=p>(</span><span class=n>theSender</span><span class=p>(),</span> <span class=n>_approved</span><span class=p>,</span> <span class=n>_tokenId</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=kc>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kd>function</span> <span class=nf>setApprovalForAll</span><span class=p>(</span><span class=kt>address</span> <span class=n>_operator</span><span class=p>,</span> <span class=kt>bool</span> <span class=n>_approved</span><span class=p>)</span> <span class=k>external</span> <span class=k>returns</span> <span class=p>(</span><span class=kt>bool</span> <span class=n>success</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>require</span><span class=p>(</span><span class=n>_operator</span> <span class=o>!=</span> <span class=n>theSender</span><span class=p>(),</span> <span class=s>&#34;Cafe721: can not approved for owner&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>operatorApprovals</span><span class=p>[</span><span class=n>theSender</span><span class=p>()][</span><span class=n>_operator</span><span class=p>]</span> <span class=o>=</span> <span class=n>_approved</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>emit</span> <span class=n>ApprovalForAll</span><span class=p>(</span><span class=n>theSender</span><span class=p>(),</span> <span class=n>_operator</span><span class=p>,</span> <span class=n>_approved</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=kc>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kd>function</span> <span class=nf>getApproved</span><span class=p>(</span><span class=kt>uint256</span> <span class=n>_tokenId</span><span class=p>)</span> <span class=k>private</span> <span class=k>view</span> <span class=k>returns</span><span class=p>(</span><span class=kt>address</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>allCafe</span><span class=p>[</span><span class=n>_tokenId</span><span class=p>].</span><span class=n>approved</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kd>function</span> <span class=nf>isApprovedForAll</span><span class=p>(</span><span class=kt>address</span> <span class=n>_owner</span><span class=p>,</span> <span class=kt>address</span> <span class=n>_operator</span><span class=p>)</span> <span class=k>public</span> <span class=k>view</span> <span class=k>returns</span> <span class=p>(</span><span class=kt>bool</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>operatorApprovals</span><span class=p>[</span><span class=n>_owner</span><span class=p>][</span><span class=n>_operator</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kd>function</span> <span class=nf>name</span><span class=p>()</span> <span class=k>external</span> <span class=k>view</span> <span class=k>returns</span> <span class=p>(</span><span class=kt>string</span> <span class=k>memory</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>_name</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kd>function</span> <span class=nf>symbol</span><span class=p>()</span> <span class=k>external</span> <span class=k>view</span> <span class=k>returns</span> <span class=p>(</span><span class=kt>string</span> <span class=k>memory</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>_symbol</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kd>function</span> <span class=nf>tokenURI</span><span class=p>(</span><span class=kt>uint256</span> <span class=n>_tokenId</span><span class=p>)</span> <span class=k>external</span> <span class=k>view</span> <span class=k>returns</span> <span class=p>(</span><span class=kt>string</span> <span class=k>memory</span> <span class=n>uri</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>allCafe</span><span class=p>[</span><span class=n>_tokenId</span><span class=p>].</span><span class=n>uri</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kd>function</span> <span class=nf>tokenSummary</span><span class=p>(</span><span class=kt>uint256</span> <span class=n>_tokenId</span><span class=p>)</span> <span class=k>external</span> <span class=k>view</span> <span class=k>returns</span> <span class=p>(</span><span class=kt>bytes32</span> <span class=n>summary</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>allCafe</span><span class=p>[</span><span class=n>_tokenId</span><span class=p>].</span><span class=n>summary</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kd>function</span> <span class=nf>totalSupply</span><span class=p>()</span> <span class=k>external</span> <span class=k>view</span> <span class=k>returns</span> <span class=p>(</span><span class=kt>uint256</span> <span class=n>totalCafe</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>_totalCafe</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kd>function</span> <span class=nf>exists</span><span class=p>(</span><span class=kt>uint256</span> <span class=n>_tokenId</span><span class=p>)</span> <span class=k>internal</span> <span class=k>view</span> <span class=k>returns</span> <span class=p>(</span><span class=kt>bool</span><span class=p>){</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>allCafe</span><span class=p>[</span><span class=n>_tokenId</span><span class=p>].</span><span class=n>owner</span> <span class=o>!=</span> <span class=kt>address</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kd>function</span> <span class=nf>zeroAddr</span><span class=p>(</span><span class=kt>address</span> <span class=n>addr</span><span class=p>)</span> <span class=k>private</span> <span class=k>pure</span> <span class=k>returns</span> <span class=p>(</span><span class=kt>bool</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>addr</span> <span class=o>!=</span> <span class=kt>address</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kd>function</span> <span class=nf>remove</span><span class=p>(</span><span class=kt>address</span> <span class=n>_from</span><span class=p>,</span> <span class=kt>uint256</span> <span class=n>_tokenId</span><span class=p>)</span> <span class=k>private</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>uint</span><span class=p>[]</span> <span class=k>storage</span> <span class=n>cafes</span> <span class=o>=</span> <span class=n>allUser</span><span class=p>[</span><span class=n>_from</span><span class=p>].</span><span class=n>cafes</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=kt>uint</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>cafes</span><span class=p>.</span><span class=n>length</span> <span class=o>-</span> <span class=mi>1</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span><span class=p>(</span><span class=n>cafes</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>==</span> <span class=n>_tokenId</span><span class=p>){</span>
</span></span><span class=line><span class=cl>        <span class=n>cafes</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>cafes</span><span class=p>[</span><span class=n>cafes</span><span class=p>.</span><span class=n>length</span> <span class=o>+</span> <span class=mi>1</span><span class=p>];</span>
</span></span><span class=line><span class=cl>        <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>delete</span> <span class=n>cafes</span><span class=p>[</span><span class=n>cafes</span><span class=p>.</span><span class=n>length</span> <span class=o>-</span> <span class=mi>1</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=n>cafes</span><span class=p>.</span><span class=n>pop</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=n>allUser</span><span class=p>[</span><span class=n>_from</span><span class=p>].</span><span class=n>cafes</span> <span class=o>=</span> <span class=n>cafes</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>allUser</span><span class=p>[</span><span class=n>_from</span><span class=p>].</span><span class=n>totalCafe</span> <span class=o>=</span> <span class=n>allUser</span><span class=p>[</span><span class=n>_from</span><span class=p>].</span><span class=n>totalCafe</span><span class=p>.</span><span class=n>sub</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cm>/*
</span></span></span><span class=line><span class=cl><span class=cm>    * address owner;
</span></span></span><span class=line><span class=cl><span class=cm>    * address approved;
</span></span></span><span class=line><span class=cl><span class=cm>    * bytes32 summary;
</span></span></span><span class=line><span class=cl><span class=cm>    * string uri; 
</span></span></span><span class=line><span class=cl><span class=cm>    */</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kd>function</span> <span class=nf>mint</span><span class=p>(</span><span class=kt>uint256</span> <span class=n>_tokenId</span><span class=p>,</span> <span class=kt>bytes32</span> <span class=n>_summary</span><span class=p>,</span> <span class=kt>string</span> <span class=k>memory</span> <span class=n>_uri</span><span class=p>)</span> <span class=k>external</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>require</span><span class=p>(</span><span class=n>allCafe</span><span class=p>[</span><span class=n>_tokenId</span><span class=p>].</span><span class=n>creator</span> <span class=o>==</span> <span class=kt>address</span><span class=p>(</span><span class=mi>0</span><span class=p>),</span> <span class=s>&#34;Cafe721: the cafe is exists.&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>allCafe</span><span class=p>[</span><span class=n>_tokenId</span><span class=p>].</span><span class=n>creator</span> <span class=o>=</span> <span class=n>theSender</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=n>allCafe</span><span class=p>[</span><span class=n>_tokenId</span><span class=p>].</span><span class=n>owner</span> <span class=o>=</span> <span class=n>theSender</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=n>allCafe</span><span class=p>[</span><span class=n>_tokenId</span><span class=p>].</span><span class=n>approved</span> <span class=o>=</span> <span class=kt>address</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>allCafe</span><span class=p>[</span><span class=n>_tokenId</span><span class=p>].</span><span class=n>summary</span> <span class=o>=</span> <span class=n>_summary</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>allCafe</span><span class=p>[</span><span class=n>_tokenId</span><span class=p>].</span><span class=n>uri</span> <span class=o>=</span> <span class=n>_uri</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// User
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>allUser</span><span class=p>[</span><span class=n>theSender</span><span class=p>()].</span><span class=n>cafes</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>_tokenId</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>allUser</span><span class=p>[</span><span class=n>theSender</span><span class=p>()].</span><span class=n>totalCafe</span> <span class=o>=</span> <span class=n>allUser</span><span class=p>[</span><span class=n>theSender</span><span class=p>()].</span><span class=n>totalCafe</span><span class=p>.</span><span class=n>add</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>_totalCafe</span> <span class=o>=</span> <span class=n>_totalCafe</span><span class=p>.</span><span class=n>add</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kd>function</span> <span class=nf>isApprovedOrOwner</span><span class=p>(</span><span class=kt>uint256</span> <span class=n>_tokenId</span><span class=p>)</span> <span class=k>private</span> <span class=k>view</span> <span class=k>returns</span> <span class=p>(</span><span class=kt>bool</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>require</span><span class=p>(</span><span class=n>exists</span><span class=p>(</span><span class=n>_tokenId</span><span class=p>),</span> <span class=s>&#34;Cafe721: the cafe is exists.&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>(</span><span class=n>theSender</span><span class=p>()</span> <span class=o>==</span> <span class=n>allCafe</span><span class=p>[</span><span class=n>_tokenId</span><span class=p>].</span><span class=n>owner</span> <span class=o>||</span> <span class=n>isApprovedForAll</span><span class=p>(</span><span class=n>allCafe</span><span class=p>[</span><span class=n>_tokenId</span><span class=p>].</span><span class=n>owner</span><span class=p>,</span> <span class=n>theSender</span><span class=p>())</span> <span class=o>||</span> <span class=n>getApproved</span><span class=p>(</span><span class=n>_tokenId</span><span class=p>)</span> <span class=o>==</span> <span class=n>theSender</span><span class=p>());</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kd>function</span> <span class=nf>checkOnERC721Received</span><span class=p>(</span><span class=kt>address</span> <span class=k>from</span><span class=p>,</span><span class=kt>address</span> <span class=n>to</span><span class=p>,</span><span class=kt>uint256</span> <span class=n>tokenId</span><span class=p>,</span><span class=kt>bytes</span> <span class=k>memory</span> <span class=n>_data</span><span class=p>)</span> <span class=k>private</span> <span class=k>returns</span> <span class=p>(</span><span class=kt>bool</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>to</span><span class=p>.</span><span class=nb>code</span><span class=p>.</span><span class=n>length</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>try</span> <span class=n>IERC721Receiver</span><span class=p>(</span><span class=n>to</span><span class=p>).</span><span class=n>onERC721Received</span><span class=p>(</span><span class=n>theSender</span><span class=p>(),</span> <span class=k>from</span><span class=p>,</span> <span class=n>tokenId</span><span class=p>,</span> <span class=n>_data</span><span class=p>)</span> <span class=k>returns</span> <span class=p>(</span><span class=kt>bytes4</span> <span class=n>retval</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=n>retval</span> <span class=o>==</span> <span class=n>IERC721Receiver</span><span class=p>.</span><span class=n>onERC721Received</span><span class=p>.</span><span class=nb>selector</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=kt>bytes</span> <span class=k>memory</span> <span class=n>reason</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=p>(</span><span class=n>reason</span><span class=p>.</span><span class=n>length</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nb>revert</span><span class=p>(</span><span class=s>&#34;ERC721: transfer to non ERC721Receiver implementer&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=k>assembly</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                        <span class=nf>revert</span><span class=p>(</span><span class=nf>add</span><span class=p>(</span><span class=mi>32</span><span class=p>,</span> <span class=n>reason</span><span class=p>),</span> <span class=nf>mload</span><span class=p>(</span><span class=n>reason</span><span class=p>))</span>
</span></span><span class=line><span class=cl>                    <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// destroyCafe
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kd>function</span> <span class=nf>destroyCafe</span><span class=p>(</span><span class=kt>uint256</span> <span class=n>_tokenId</span><span class=p>)</span> <span class=k>external</span>  <span class=k>returns</span> <span class=p>(</span><span class=kt>bool</span> <span class=n>success</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>require</span><span class=p>(</span><span class=n>allCafe</span><span class=p>[</span><span class=n>_tokenId</span><span class=p>].</span><span class=n>owner</span> <span class=o>==</span> <span class=n>theSender</span><span class=p>(),</span> <span class=s>&#34;Cafe721: no premission&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>remove</span><span class=p>(</span><span class=n>theSender</span><span class=p>(),</span> <span class=n>_tokenId</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>delete</span> <span class=n>allCafe</span><span class=p>[</span><span class=n>_tokenId</span><span class=p>];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>_totalCafe</span> <span class=o>=</span> <span class=n>_totalCafe</span><span class=p>.</span><span class=n>sub</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=kc>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kd>function</span> <span class=nf>theSender</span><span class=p>()</span> <span class=k>internal</span> <span class=k>view</span> <span class=k>returns</span> <span class=p>(</span><span class=kt>address</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nb>msg</span><span class=p>.</span><span class=nb>sender</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>library</span> <span class=n>SafeMath</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kd>function</span> <span class=nf>mul</span><span class=p>(</span><span class=kt>uint256</span> <span class=n>a</span><span class=p>,</span> <span class=kt>uint256</span> <span class=n>b</span><span class=p>)</span> <span class=k>internal</span> <span class=k>pure</span> <span class=k>returns</span> <span class=p>(</span><span class=kt>uint256</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Gas optimization: this is cheaper than requiring &#39;a&#39; not being zero, but the
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// benefit is lost if &#39;b&#39; is also tested.
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// See: https://github.com/OpenZeppelin/openzeppelin-solidity/pull/522
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>if</span> <span class=p>(</span><span class=n>a</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kt>uint256</span> <span class=n>c</span> <span class=o>=</span> <span class=n>a</span> <span class=o>*</span> <span class=n>b</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nb>require</span><span class=p>(</span><span class=n>c</span> <span class=o>/</span> <span class=n>a</span> <span class=o>==</span> <span class=n>b</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>c</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>  * @dev Integer division of two numbers truncating the quotient, reverts on division by zero.
</span></span></span><span class=line><span class=cl><span class=cm>  */</span>
</span></span><span class=line><span class=cl>  <span class=kd>function</span> <span class=nf>div</span><span class=p>(</span><span class=kt>uint256</span> <span class=n>a</span><span class=p>,</span> <span class=kt>uint256</span> <span class=n>b</span><span class=p>)</span> <span class=k>internal</span> <span class=k>pure</span> <span class=k>returns</span> <span class=p>(</span><span class=kt>uint256</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>require</span><span class=p>(</span><span class=n>b</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>);</span> <span class=c1>// Solidity only automatically asserts when dividing by 0
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kt>uint256</span> <span class=n>c</span> <span class=o>=</span> <span class=n>a</span> <span class=o>/</span> <span class=n>b</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=c1>// assert(a == b * c + a % b); // There is no case in which this doesn&#39;t hold
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>c</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>  * @dev Subtracts two numbers, reverts on overflow (i.e. if subtrahend is greater than minuend).
</span></span></span><span class=line><span class=cl><span class=cm>  */</span>
</span></span><span class=line><span class=cl>  <span class=kd>function</span> <span class=nf>sub</span><span class=p>(</span><span class=kt>uint256</span> <span class=n>a</span><span class=p>,</span> <span class=kt>uint256</span> <span class=n>b</span><span class=p>)</span> <span class=k>internal</span> <span class=k>pure</span> <span class=k>returns</span> <span class=p>(</span><span class=kt>uint256</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>require</span><span class=p>(</span><span class=n>b</span> <span class=o>&lt;=</span> <span class=n>a</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kt>uint256</span> <span class=n>c</span> <span class=o>=</span> <span class=n>a</span> <span class=o>-</span> <span class=n>b</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>c</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>  * @dev Adds two numbers, reverts on overflow.
</span></span></span><span class=line><span class=cl><span class=cm>  */</span>
</span></span><span class=line><span class=cl>  <span class=kd>function</span> <span class=nf>add</span><span class=p>(</span><span class=kt>uint256</span> <span class=n>a</span><span class=p>,</span> <span class=kt>uint256</span> <span class=n>b</span><span class=p>)</span> <span class=k>internal</span> <span class=k>pure</span> <span class=k>returns</span> <span class=p>(</span><span class=kt>uint256</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>uint256</span> <span class=n>c</span> <span class=o>=</span> <span class=n>a</span> <span class=o>+</span> <span class=n>b</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nb>require</span><span class=p>(</span><span class=n>c</span> <span class=o>&gt;=</span> <span class=n>a</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>c</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>  * @dev Divides two numbers and returns the remainder (unsigned integer modulo),
</span></span></span><span class=line><span class=cl><span class=cm>  * reverts when dividing by zero.
</span></span></span><span class=line><span class=cl><span class=cm>  */</span>
</span></span><span class=line><span class=cl>  <span class=kd>function</span> <span class=nf>mod</span><span class=p>(</span><span class=kt>uint256</span> <span class=n>a</span><span class=p>,</span> <span class=kt>uint256</span> <span class=n>b</span><span class=p>)</span> <span class=k>internal</span> <span class=k>pure</span> <span class=k>returns</span> <span class=p>(</span><span class=kt>uint256</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>require</span><span class=p>(</span><span class=n>b</span> <span class=o>!=</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>a</span> <span class=o>%</span> <span class=n>b</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div></div></div></section><footer class=article-footer><section class=article-tags><a href=/tags/solidity/>Solidity</a></section></footer><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/katex.min.css integrity="sha256-J+iAE0sgH8QSz9hpcDxXIftnj65JEZgNhGcgReTTK9s=" crossorigin=anonymous><script src=https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/katex.min.js integrity="sha256-InsNdER1b2xUewP+pKCUJpkhiqwHgqiPXDlIk7GzBu4=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/contrib/auto-render.min.js integrity="sha256-y39Mpg7V3D4lhBX4x6O0bUqTV4pSrfgwEfGKfxkOdgI=" crossorigin=anonymous defer></script><script>window.addEventListener("DOMContentLoaded",()=>{renderMathInElement(document.querySelector(`.article-content`),{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}]})})</script></article><aside class=related-content--wrapper><h2 class=section-title>相关文章</h2><div class=related-content><div class="flex article-list--tile"><article><a href=/p/erc20/><div class=article-details><h2 class=article-title>ERC20合约</h2></div></a></article><article class=has-image><a href=/p/campaign/><div class=article-image><img src=/p/campaign/header.b54ef63caf3b07d0b3c66b809610bc6c_hud30b7d800d6a863e0643d87b3a87316b_148688_250x150_fill_q75_box_smart1.jpg width=250 height=150 loading=lazy alt="Featured image of post 提案投票合约" data-key=campaign data-hash="md5-tU72PK87B9CzxmuAlhC8bA=="></div><div class=article-details><h2 class=article-title>提案投票合约</h2></div></a></article><article class=has-image><a href=/p/shortcontent/><div class=article-image><img src=/p/shortcontent/header.bae5a6003c1363eb332de83ed88ba887_hu58eb6555178a77861c10495595dbf0eb_18332_250x150_fill_q75_box_smart1.jpg width=250 height=150 loading=lazy alt="Featured image of post 短内容存证合约" data-key=shortContent data-hash="md5-uuWmADwTY+szLeg+2Iuohw=="></div><div class=article-details><h2 class=article-title>短内容存证合约</h2></div></a></article></div></div></aside><footer class=site-footer><section class=copyright>&copy;
2020 -
2023 Laertes</section><section class=powerby>山外风雨三尺剑，有事提剑下山去<br>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>主题 <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=4.0.0-alpha.0>Stack</a></b> 由 <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a> 设计</section></footer><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@5.2.7/dist/photoswipe.css integrity="sha256-olf9rfn3AG8zR6lkPXkN3PZq63z8tElx7Ela6T4eklo=" crossorigin=anonymous><script type=module>
    import StackGallery from '\/ts\/gallery.js';
    import PhotoSwipeLightbox from 'https://cdn.jsdelivr.net/npm/photoswipe@5.2.7/dist/photoswipe-lightbox.esm.min.js';
    
    console.log(StackGallery)
    StackGallery(document.querySelector('.article-content'));

    const lightbox = new PhotoSwipeLightbox({
        gallery: '.article-content',
        children: '.gallery-image a',
        pswpModule: () => import('https://cdn.jsdelivr.net/npm/photoswipe@5.2.7/dist/photoswipe.esm.min.js')
    });
    lightbox.init();
</script></main><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">目录</h2><div class=widget--toc><nav id=TableOfContents><ol><li><ol><li><a href=#erc721>ERC721</a></li></ol></li></ol></nav></div></section></aside></div><script type=text/javascript src=/ts/main.js defer></script>
<script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>